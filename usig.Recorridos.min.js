if(typeof(usig)=="undefined"){usig={}}if(typeof(usig.defaults)=="undefined"){usig.defaults={}}usig.TripTemplate=function(b,a){this.index=b;this.color=a;this.cls="trip_"+b};usig.defaults.Recorridos={debug:false,trackVisits:false,piwikBaseUrl:"http://usig.buenosaires.gov.ar/piwik/",piwikSiteId:4,server:"http://recorridos.usig.buenosaires.gob.ar/2.0/",serverTimeout:30000,maxRetries:2,consultaRecorridos:{tipo:"transporte",gml:true,precargar:3,opciones_caminata:800,opciones_medios_colectivo:true,opciones_medios_subte:true,opciones_medios_tren:true,opciones_prioridad:"avenidas",opciones_incluir_autopistas:true},colorTemplates:[new usig.TripTemplate(1,"#8F58C7"),new usig.TripTemplate(2,"#E34900"),new usig.TripTemplate(3,"#C3E401"),new usig.TripTemplate(4,"#F9B528"),new usig.TripTemplate(5,"#D71440"),new usig.TripTemplate(6,"#007baf"),new usig.TripTemplate(7,"#495a78"),new usig.TripTemplate(8,"#b56c7d"),new usig.TripTemplate(9,"#669966"),new usig.TripTemplate(10,"#ff3300")]};usig.Recorridos=(function(a){return new (usig.AjaxComponent.extend({lastRequest:null,init:function(c){var d=a.extend({},usig.defaults.Recorridos,c);d.consultaRecorridos=a.extend({},usig.defaults.Recorridos.consultaRecorridos,c);this._super("Recorridos",usig.defaults.Recorridos.server,d);var b=function(e){try{var g=Piwik.getTracker(d.piwikBaseUrl+"piwik.php",e);g.trackPageView();g.enableLinkTracking()}catch(f){}};if(d.trackVisits){if(typeof(Piwik)=="undefined"){usig.loadJs(d.piwikBaseUrl+"piwik.js",b.createDelegate(this,[d.piwikSiteId]))}else{b(d.piwikSiteId)}}return this},getUbicacion:function(b){var c={coordenadas:{x:0,y:0},codigo_calle:0,altura:0,codigo_calle2:0};if(b.x!=undefined&&b.y!=undefined){c.coordenadas=b}if(usig.Direccion&&b instanceof usig.Direccion){if(b.getTipo()==usig.Direccion.CALLE_Y_CALLE){c.codigo_calle2=b.getCalleCruce().codigo}c.coordenadas=b.getCoordenadas();c.codigo_calle=b.getCalle().codigo;c.altura=b.getAltura()}if(usig.inventario&&usig.inventario.Objeto&&b instanceof usig.inventario.Objeto){if(b.direccionAsociada){c.coordenadas=b.direccionAsociada.getCoordenadas();c.codigo_calle=b.direccionAsociada.getCalle().codigo;c.altura=b.direccionAsociada.getAltura()}else{c.coordenadas=b.ubicacion.getCentroide()}}if(usig.DireccionMapabsas&&b instanceof usig.DireccionMapabsas){if(b.tipo==usig.Direccion.CALLE_Y_CALLE){c.codigo_calle2=b.cod_calle_cruce}c.codigo_calle=b.cod;c.altura=b.alt}return c},onBuscarRecorridosSuccess:function(d,e){var b=[],c=this.opts.colorTemplates;if(this.opts.debug){usig.debug("usig.Recorridos onBuscarRecorridosSuccess")}a.each(d.planning,function(f,g){b.push(new usig.Recorrido(JSON.parse(g),{template:c[f]}))});if(typeof(e)=="function"){e(b)}},loadTripPlan:function(c,d,b){this.lastRequest=this.mkRequest(c,d,b,this.opts.server+"load_plan")},consultarRecorridos:function(d,c,e,b){this.lastRequest=this.mkRequest(d,e,b,this.opts.server+"recorridos_"+c)},InfoTransporte:function(c,d,b){this.lastRequest=this.mkRequest(c,d,b,this.opts.server+"info_transporte/")},buscarRecorridos:function(e,d,h,c,b){var f=a.extend({},this.opts.consultaRecorridos,b);var g=this.getUbicacion(e);if(g.coordenadas){f.origen=g.coordenadas.x+","+g.coordenadas.y}f.origen_calles2=g.codigo_calle2;f.origen_calles=g.codigo_calle;f.origen_calle_altura=g.altura;var j=this.getUbicacion(d);if(j.coordenadas){f.destino=j.coordenadas.x+","+j.coordenadas.y}f.destino_calles2=j.codigo_calle2;f.destino_calles=j.codigo_calle;f.destino_calle_altura=j.altura;this.lastRequest=this.mkRequest(f,this.onBuscarRecorridosSuccess.createDelegate(this,[h],1),c,this.opts.server+"consultar_recorridos")},cargarPlanRecorrido:function(f,e,c,b){var d=a.extend({},this.opts.consultaRecorridos,b);d.trip_id=f;d.tipo="loadplan";this.lastRequest=this.mkRequest(d,e,c,this.opts.server+"consultar_recorridos")},transportesCercanos:function(e,f,c){var b=this.getUbicacion(e);var d={x:b.coordenadas.x,y:b.coordenadas.y};this.lastRequest=this.mkRequest(d,f,c,this.opts.server+"info_transporte/")},cicloviasCercanas:function(f,g,d,c){var b=this.getUbicacion(f);var e={lon:b.coordenadas.x,lat:b.coordenadas.y};if(c){if(c.radio){e.radio=c.radio}if(c.cantidad){e.cantidad=c.cantidad}}this.lastRequest=this.mkRequest(e,g,d,this.opts.server+"ciclovias_cercanas/")}}))})(jQuery);if(typeof(usig)=="undefined"){usig={}}if(typeof(usig.Recorrido)=="undefined"){usig.Recorrido=(function(a){return function(q,g){var p=0,e=0,o,s,d,j,c,u,l,h="Sin datos",v="Sin datos",r=[],f=0,m=a.extend({},usig.Recorrido.defaults,g);getServiceIcon=function(w){var x="";if(w==0){x="recorrido_pie"}if(w==1){x="recorrido_subte"}if(w==2){x="recorrido_tren"}if(w==3){x="recorrido_colectivo"}return'<img src="'+m.icons[x]+'" width="20" height="20">'};function t(){var w=[];v="";if(d=="transporte_publico"){a.each(j,function(y,z){if(z.type=="Board"){if(!z.any_trip&&z.service_type!=1){if(z.trip_description!=""){var x="Ramales: "+z.trip_description.replace("$",", ");v+=getServiceIcon(z.service_type)+" "+z.service+'  <span class="ramales" title="'+x+'">(*)</span>';w.push(z.service+" ("+x+")")}else{v+=getServiceIcon(z.service_type)+" "+z.service+' <span class="ramales" title="'+m.texts.hayRamales+'">(*)  </span>';w.push(z.service+" ("+m.texts.hayRamales+")")}}else{v+=getServiceIcon(z.service_type)+" "+z.service+"  ";w.push(z.service)}}});h=w.join(", ")}else{if(d=="walk"){h=m.texts.descWalk;a.each(j,function(x,y){if(y.type!=undefined&&y.type=="StartWalking"){v+='<img src="'+m.icons.recorrido_pie+'" width="20" height="20"> '+h}})}else{if(d=="car"){h=m.texts.descCar;a.each(j,function(x,y){if(y.type!=undefined&&y.type=="StartDriving"){v+='<img src="'+m.icons.recorrido_auto+'" width="20" height="20"> '+h}})}}}}function n(){if(d=="transporte_publico"){var A=null;var y=false;var E=0;var w=null;var C=null;for(i=0;i<c.length;i++){var G=c[i];if(G.type!=undefined){if(G.type=="StartWalking"){y=true;if(i==0){A="Caminar desde "+c[i+1].name+" "+c[i+1].from}else{A="Caminar desde "+c[i-1].stop_description}C="pie"}else{if(G.type=="FinishWalking"){if(A){A+=" hasta destino.";r.push({text:A,type:C});A=null;C=null}y=false}else{if(G.type=="Board"){var x=y;if(y){if(G.service_type=="3"){A+=" hasta "+G.stop_description}else{A+=" hasta la estaci��n "+G.stop_name+" en "+G.stop_description}if(!(A.charAt(A.length-1)==".")){A+="."}r.push({text:A,type:C});y=false;A=null;C=null}if(G.service_type=="1"){A='Tomar el <span class="transport">SUBTE '+G.service.toUpperCase()+"</span> ";if(E>0){A+=" en la estaci��n "+G.stop_name}C="subte"}else{if(G.service_type=="3"){if(G.trip_description!=""&&!G.any_trip){w=" (Ramales: "+G.trip_description.replace("$",", ")+")"}else{w=(!G.any_trip)?" ("+m.texts.hayRamales+")":""}A='Tomar el <span class="transport">COLECTIVO '+G.service+w+" </span> ";C="colectivo"}else{if(G.service_type=="2"){if(G.trip_description!=""&&!G.any_trip){w=" ("+G.trip_description.replace("$"," y ")+")"}else{w=(!G.any_trip)?" ("+m.texts.hayRamales+")":""}A='Tomar el <span class="transport">TREN '+G.service.toUpperCase()+w+"</span> ";C="tren";if(E>0){A+=" en la estaci��n "+G.stop_name}}}}if(!x){A+=" en "+G.stop_description}E+=1}else{if(G.type=="Alight"){if(G.service_type!=undefined&&(G.service_type=="2"||G.service_type=="1")){A+=" y bajar en la estaci��n "+G.stop_name}else{A+=" y bajar en "+G.stop_description}if(!(A.charAt(A.length-1)==".")){A+="."}r.push({text:A,type:C});A=null;C=null}else{if(G.type=="Bus"){}else{if(G.type=="SubWay"){}else{if(G.type=="SubWayConnection"){r.push({text:A,type:C});A='Combinar con el <span class="transport">SUBTE '+G.service_to.toUpperCase()+"</span> en estaci��n "+G.stop;C="subte"}else{if(G.type=="Street"){}}}}}}}}}}}else{if(d=="walk"){var z=new Array();var B=0;for(i=0;i<c.length;i++){var G=c[i];if(G.type!=undefined){var F=null;if(G.type=="Street"){B++;F=G.name+" ";if(typeof(G.from)!="undefined"){F+=G.from}if(typeof(G.to)!="undefined"){F+=" - "+G.to}z.push({type:"walk",text:F,distance:G.distance,index:B,id:G.id})}}}r=z}else{if(d=="car"){z=new Array();B=0;var F;for(i=0;i<c.length;i++){var G=c[i];if(G.type!=undefined){var D;if(G.type=="Street"){B++;if(G.indicacion_giro!="0"&&G.indicacion_giro!="1"&&G.indicacion_giro!="2"){F="Ir desde ";D="seguir"}else{if(G.indicacion_giro=="0"){F="Seguir por ";D="seguir"}else{if(G.indicacion_giro=="1"){F="Doblar a la izquierda en ";D="izquierda"}else{if(G.indicacion_giro=="2"){F="Doblar a la derecha en ";D="derecha"}}}}F+=G.name+" ";if(G.from){F+=G.from}if(G.to){F+=" hasta el "+G.to}z.push({text:F,turn_indication:D,index:B,distance:G.distance,type:"car",id:G.id})}}}r=z}}}}function b(w){try{p=w.id;e=w.tiempo;o=w.origen;s=w.destino;d=w.type;j=w.summary;f=w.traveled_distance;u=a.extend({},w);u.options=m;t();k(w)}catch(x){usig.debug(x)}}function k(w,x){if(!c&&w.plan){c=w.plan;u.plan=w.plan;n()}if(typeof(x)=="function"){x(r,c)}}this.load=function(w){b(w)};this.toString=function(){return h};this.toHtmlString=function(){return v};this.getTime=function(){return e};this.getTraveledDistance=function(){return f};this.getTimeString=function(){time="";if(e>60){hs=Math.round(e/60);mins=e%60;time+=hs+(hs>1?"hs ":"h ")+mins+" '"}else{time+=e+" '"}return time};this.getPlan=function(x,w,y){if(!c){usig.Recorridos.cargarPlanRecorrido(p,k.createDelegate(this,[x],1),w,y)}else{if(typeof(x)=="function"){x(c)}}return c};this.getDetalle=function(x,w,y){if(!c){if(u.plan){k(u,x)}else{usig.Recorridos.cargarPlanRecorrido(p,k.createDelegate(this,[x],1),w,y)}}else{if(typeof(x)=="function"){x(r)}}};this.getId=function(){return p};this.getTemplate=function(){return m.template};this.getColor=function(){return m.template.color};this.getTipo=function(){return d};this.setColor=function(w){m.template.color=w};this.getCoordenadaOrigen=function(){return o};this.getCoordenadaDestino=function(){return s};this.toJson=function(){return u};this.isEqual=function(w){return d==w.getTipo()&&h==w.toString()&&o==w.getCoordenadaOrigen()&&s==w.getCoordenadaDestino()};if(q){b(q)}}})(jQuery);usig.Recorrido.fromObj=function(a){return new usig.Recorrido(a,a.options)};usig.Recorrido.defaults={icons:{recorrido_pie:"http://mapa.buenosaires.gob.ar/images/recorrido_pie20x20.png",recorrido_subte:"http://mapa.buenosaires.gob.ar/images/recorrido_subte20x20.png",recorrido_tren:"http://mapa.buenosaires.gob.ar/images/recorrido_tren20x20.png",recorrido_colectivo:"http://mapa.buenosaires.gob.ar/images/recorrido_colectivo20x20.png",recorrido_auto:"http://mapa.buenosaires.gob.ar/images/recorrido_auto20x20.png"},template:new usig.TripTemplate(1,"#8F58C7"),texts:{descWalk:"Recorrido a pie",descCar:"Recorrido en auto",hayRamales:"No todos los ramales conducen a destino"}}};